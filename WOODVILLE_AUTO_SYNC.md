# Автоматическая синхронизация остатков с Woodville

## Возможность ежедневной проверки

**Да, парсинг может автоматически проверять остатки каждый день!**

## Варианты настройки автоматического запуска

### Вариант 1: Vercel Cron Jobs (рекомендуется)

Если ваш сайт размещен на Vercel:

1. **Создайте файл `vercel.json`** (если его нет) или обновите существующий:

```json
{
  "crons": [
    {
      "path": "/api/cron/sync-woodville-stock",
      "schedule": "0 2 * * *"
    }
  ]
}
```

**Расписание:**
- `0 2 * * *` — каждый день в 2:00 UTC (5:00 МСК)
- `0 */6 * * *` — каждые 6 часов
- `0 9 * * 1-5` — каждый рабочий день в 9:00 UTC

2. **Добавьте секретный ключ для безопасности:**

В Vercel → Settings → Environment Variables:
```
CRON_SECRET=your_random_secret_key_here
```

### Вариант 2: Внешний сервис Cron Jobs

Если не используете Vercel или нужен более гибкий контроль:

**Сервисы:**
- [cron-job.org](https://cron-job.org) (бесплатно)
- [EasyCron](https://www.easycron.com) (бесплатно)
- [UptimeRobot](https://uptimerobot.com) (бесплатно)

**Настройка:**
1. Зарегистрируйтесь на сервисе
2. Создайте новую задачу:
   - **URL:** `https://your-domain.com/api/cron/sync-woodville-stock`
   - **Schedule:** каждый день в нужное время
   - **Method:** GET
   - **Headers:** `Authorization: Bearer your_cron_secret`

### Вариант 3: Ручной запуск из админ-панели

Добавить кнопку в админ-панели для ручного запуска синхронизации.

## Как это будет работать

### Ежедневный процесс:

1. **В указанное время** (например, каждый день в 2:00)
2. **Cron job вызывает** `/api/cron/sync-woodville-stock`
3. **Система получает список** товаров из базы данных
4. **Для каждого товара:**
   - Находит соответствующий товар на Woodville (по артикулу или URL)
   - Парсит страницу товара
   - Извлекает остатки со складов
   - Обновляет `stock_quantity` в базе данных
5. **Логирует результаты** синхронизации

### Что будет обновляться:

- `stock_quantity` в таблице `products`
- Дата последней синхронизации
- История изменений остатков (опционально)

## Частота синхронизации

**Рекомендации:**

- **Ежедневно** — оптимально для большинства магазинов
- **Каждые 6 часов** — если остатки меняются часто
- **Каждые 12 часов** — если остатки меняются редко
- **По требованию** — ручной запуск из админ-панели

## Безопасность

Для защиты от несанкционированного доступа:

1. **Секретный ключ** в переменной окружения `CRON_SECRET`
2. **Проверка авторизации** в cron endpoint
3. **Логирование** всех запросов

## Мониторинг

После настройки можно отслеживать:

- Логи синхронизации в Vercel
- Таблицу `product_supplier_links` с датами последней синхронизации
- Уведомления об ошибках (опционально)

## Пример расписания

```json
// Каждый день в 2:00 UTC (5:00 МСК)
"0 2 * * *"

// Каждые 6 часов
"0 */6 * * *"

// Каждый рабочий день в 9:00 UTC
"0 9 * * 1-5"

// Два раза в день: утром и вечером
"0 9,21 * * *"
```

## Что нужно для запуска

После получения данных о товарах:

1. ✅ Реализую парсинг остатков
2. ✅ Настрою автоматический запуск
3. ✅ Добавлю логирование
4. ✅ Создам интерфейс в админ-панели для мониторинга

**Результат:** Остатки будут автоматически обновляться каждый день без вашего участия!

