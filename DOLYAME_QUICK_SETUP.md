# Быстрая настройка Долями

## Что нужно добавить в `.env.local`

Создайте или откройте файл `.env.local` в корне проекта и добавьте следующие строки:

```env
# Долями (Dolyame) Payment Configuration
DOLYAME_LOGIN=6a35abec-f11a-4c02-95ed-2f566d13bd23
DOLYAME_PASSWORD=8926416Salavat1996s@
DOLYAME_API_URL=https://partner.dolyame.ru/v1/orders
NEXT_PUBLIC_DOLYAME_SITE_ID=your_site_id  # Site ID для сниппета (получите от менеджера Долями)
DOLYAME_CERT_PATH=./certs/client.crt
DOLYAME_KEY_PATH=./certs/client.key
DOLYAME_CA_PATH=./certs/ca.crt
```

## Можно ли протестировать без сертификата?

**Короткий ответ:** Частично да, но для реальной работы нужен сертификат.

**Что можно протестировать без сертификата:**
- ✅ Логику создания заявки (формирование данных)
- ✅ Валидацию полей
- ✅ Обработку ошибок
- ✅ UI/UX (кнопки, формы)

**Что НЕ будет работать без сертификата:**
- ❌ Реальные запросы к API Долями (вернется ошибка 403/401)
- ❌ Создание реальных заявок
- ❌ Редирект на страницу оплаты

**Для тестирования без сертификата:**
1. Добавьте переменные в `.env.local` (без путей к сертификатам)
2. Попробуйте создать заявку - увидите ошибку от API
3. Это поможет проверить, что логика работает правильно

**Для реальной работы:**
Нужно обязательно выпустить mTLS сертификат согласно инструкциям Долями.

## Что нужно сделать дальше

### 1. Выпустить mTLS сертификат

Для работы с API Долями требуется mTLS сертификат. Инструкции:
- https://dolyame.ru/develop/api/preparation/
- Выпуск в личном кабинете Т‑Бизнеса

### 2. Сохранить сертификаты

После получения сертификатов:

1. **Создайте папку `certs` в корне проекта:**
   ```bash
   mkdir certs
   ```

2. **Скопируйте файлы сертификатов в папку `certs`:**
   - `client.crt` → `certs/client.crt`
   - `client.key` → `certs/client.key`
   - `ca.crt` → `certs/ca.crt` (если есть)

3. **Убедитесь, что пути в `.env.local` указаны правильно:**
   ```env
   DOLYAME_CERT_PATH=./certs/client.crt
   DOLYAME_KEY_PATH=./certs/client.key
   DOLYAME_CA_PATH=./certs/ca.crt
   ```

### 3. Перезапустить сервер

```bash
npm run dev
```

### 4. Протестировать

1. Добавьте товар в корзину
2. Выберите "Оплата частями с Долями"
3. Нажмите "Оплатить частями с Долями"
4. Проверьте логи в консоли

## Настройка на Vercel (для production)

1. Перейдите в **Settings** → **Environment Variables**
2. Добавьте переменные:
   - `DOLYAME_LOGIN` = `6a35abec-f11a-4c02-95ed-2f566d13bd23`
   - `DOLYAME_PASSWORD` = `8926416Salavat1996s@`
   - `DOLYAME_API_URL` = `https://partner.dolyame.ru/v1/orders`

3. Для сертификатов используйте **Vercel Secrets** или загрузите их при деплое

## Важно

- **НЕ коммитьте** `.env.local` в git (уже в `.gitignore`)
- **НЕ коммитьте** сертификаты в git (папка `certs/` уже в `.gitignore`)
- Сертификаты должны быть в формате PEM

