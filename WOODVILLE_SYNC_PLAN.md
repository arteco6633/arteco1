# План синхронизации остатков с Woodville.ru

## Возможность реализации

**Да, это возможно**, но есть несколько важных моментов:

### Варианты реализации:

1. **Веб-скрапинг (парсинг HTML)** — технически возможно
2. **API интеграция** — предпочтительно, если у Woodville есть API
3. **Ручной импорт** — через CSV/Excel файлы

## Что нужно для реализации

### 1. Данные для сопоставления товаров

Для автоматической синхронизации нужно знать, как сопоставить товары между двумя сайтами:

**Вариант A: По артикулу (SKU)**
- У каждого товара на вашем сайте должен быть артикул (SKU)
- Этот же артикул должен быть на сайте Woodville
- Пример: если у вас товар с артикулом `15938`, нужно найти товар с таким же артикулом на Woodville

**Вариант B: По названию товара**
- Менее надежно, но возможно
- Сопоставление по названию товара + дополнительные параметры (цвет, размер)

**Вариант C: Таблица соответствий**
- Создать таблицу в базе данных с соответствием:
  - Ваш товар ID → Woodville товар ID/URL/артикул

### 2. Структура данных на Woodville

Нужно понять, как на сайте Woodville отображаются остатки:
- Где именно на странице показывается остаток?
- В каком формате (число, текст типа "Много", "нет в наличии")?
- Есть ли отдельные склады (Москва, Уфа)?

### 3. Технические детали

**Для парсинга нужно:**
- URL страницы товара на Woodville
- Селекторы CSS для извлечения остатков
- Обработка различных форматов остатков ("Много", "24", "нет в наличии")

## Рекомендуемый подход

### Шаг 1: Создать таблицу соответствий

Добавить в базу данных таблицу для связи товаров:

```sql
CREATE TABLE IF NOT EXISTS product_supplier_links (
  id BIGSERIAL PRIMARY KEY,
  product_id BIGINT REFERENCES products(id) ON DELETE CASCADE,
  supplier_name VARCHAR(100) DEFAULT 'woodville',
  supplier_product_url TEXT, -- URL товара на Woodville
  supplier_sku VARCHAR(100), -- Артикул на Woodville
  last_sync_at TIMESTAMPTZ,
  last_stock_moscow INTEGER DEFAULT 0,
  last_stock_ufa INTEGER DEFAULT 0,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

### Шаг 2: Создать API роут для синхронизации

Создать `/api/admin/sync-stock` который будет:
1. Парсить страницы товаров на Woodville
2. Извлекать остатки
3. Обновлять `stock_quantity` в таблице `products`

### Шаг 3: Настроить автоматический запуск

Запускать синхронизацию:
- По расписанию (cron job)
- Вручную из админ-панели
- При изменении товара

## Какие данные мне нужны от вас

### Обязательно:

1. **Таблица соответствий товаров:**
   - Список ваших товаров с их артикулами (SKU)
   - Соответствующие URL товаров на Woodville
   - Или артикулы товаров на Woodville

   **Формат:**
   ```
   Ваш товар ID | Ваш SKU | Woodville URL | Woodville SKU
   1            | 15938   | https://woodville.ru/... | 15938
   ```

2. **Формат остатков на Woodville:**
   - Как именно отображаются остатки? (текст, число)
   - Есть ли отдельные склады? (Москва, Уфа)
   - Что означает "Много"? (какое число использовать)

### Опционально:

3. **Частота синхронизации:**
   - Как часто обновлять остатки? (раз в час, день, неделю)

4. **Логика обновления:**
   - Обновлять только если остаток изменился?
   - Что делать, если товар исчез с Woodville?
   - Как обрабатывать "нет в наличии"?

## Альтернативные решения

### 1. API интеграция (предпочтительно)

**Свяжитесь с Woodville** и спросите:
- Есть ли у них API для получения остатков?
- Можно ли получить доступ к API?
- Есть ли возможность экспорта остатков (CSV, Excel)?

**Преимущества:**
- Более надежно
- Не зависит от изменений структуры сайта
- Легально

### 2. Ручной импорт через CSV

Если Woodville предоставляет файлы с остатками:
- Создать страницу в админ-панели для загрузки CSV
- Автоматически обновлять остатки из файла

### 3. Интеграция через 1С/другие системы

Если у вас есть интеграция с 1С или другими системами учета:
- Синхронизировать остатки через эти системы

## Юридические аспекты

⚠️ **Важно:**
- Веб-скрапинг может нарушать Terms of Service сайта
- Рекомендуется получить разрешение от Woodville
- Лучше использовать официальное API, если оно есть

## Пример реализации

После получения данных я могу создать:

1. **Таблицу соответствий** в базе данных
2. **API роут** `/api/admin/sync-stock` для синхронизации
3. **Страницу в админ-панели** для управления синхронизацией
4. **Автоматический запуск** по расписанию

## Что нужно сделать сейчас

1. **Создайте таблицу соответствий:**
   - Экспортируйте список ваших товаров с артикулами
   - Найдите соответствующие товары на Woodville
   - Составьте таблицу соответствий

2. **Уточните формат остатков:**
   - Посмотрите на странице товара, как отображаются остатки
   - Определите, как парсить "Много", "нет в наличии" и т.д.

3. **Свяжитесь с Woodville:**
   - Спросите про API или возможность экспорта остатков

После получения этих данных я смогу реализовать автоматическую синхронизацию.

